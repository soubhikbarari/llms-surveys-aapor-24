{"SurveyEntry":{"SurveyID":"SV_4SnFxCjRrDUHhrg","SurveyName":"AAPOR 2024 Demo (v2 - js)","SurveyDescription":null,"SurveyOwnerID":"UR_d5NLLNWEDVv28Ae","SurveyBrandID":"norc","DivisionID":null,"SurveyLanguage":"EN","SurveyActiveResponseSet":"RS_eyrJnYYyoa9hjdI","SurveyStatus":"Active","SurveyStartDate":"0000-00-00 00:00:00","SurveyExpirationDate":"0000-00-00 00:00:00","SurveyCreationDate":"2024-10-03 13:36:26","CreatorID":"UR_d5NLLNWEDVv28Ae","LastModified":"2024-10-08 10:01:35","LastAccessed":"0000-00-00 00:00:00","LastActivated":"2024-10-07 10:54:11","Deleted":null},"SurveyElements":[{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"BL","PrimaryAttribute":"Survey Blocks","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":[{"Type":"Default","Description":"Base Question","ID":"BL_4SXcXdRfVUjwHIy","BlockElements":[{"Type":"Question","QuestionID":"QID1"}]},{"Type":"Trash","Description":"Trash \/ Unused Questions","ID":"BL_3t5oWEMFfrZYpG6","BlockElements":[{"Type":"Question","QuestionID":"QID4"}]},{"Type":"Standard","SubType":"","Description":"Adaptive Question","ID":"BL_4IuG15u7fM1qreC","BlockElements":[{"Type":"Question","QuestionID":"QID2"}]},{"Type":"Standard","SubType":"","Description":"Create Prompt","ID":"BL_eD8roeWH1uSNmOG","Options":{"BlockLocking":"false","RandomizeQuestions":"false","BlockVisibility":"Expanded"},"BlockElements":[{"Type":"Question","QuestionID":"QID3"}]}]},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"FL","PrimaryAttribute":"Survey Flow","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":{"Type":"Root","FlowID":"FL_1","Flow":[{"Type":"EmbeddedData","FlowID":"FL_8","EmbeddedData":[{"Description":"baseModel","Type":"Custom","Field":"baseModel","VariableType":"String","DataVisibility":[],"AnalyzeText":false,"Value":"gpt-4o-mini"},{"Description":"apiKey","Type":"Custom","Field":"apiKey","VariableType":"String","DataVisibility":[],"AnalyzeText":false,"Value":"Bearer XXXXXXXXXXXXXXX"},{"Description":"apiUrl","Type":"Custom","Field":"apiUrl","VariableType":"String","DataVisibility":[],"AnalyzeText":false,"Value":"https:\/\/api.openai.com\/v1\/chat\/completions"}]},{"Type":"Block","ID":"BL_4SXcXdRfVUjwHIy","FlowID":"FL_2","Autofill":[]},{"Type":"Standard","ID":"BL_eD8roeWH1uSNmOG","FlowID":"FL_7","Autofill":[]},{"Type":"Standard","ID":"BL_4IuG15u7fM1qreC","FlowID":"FL_3","Autofill":[]}],"Properties":{"Count":9}}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"PL","PrimaryAttribute":"Preview Link","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":{"PreviewType":"Public","PreviewID":"7d1e82f7-2357-4404-8102-fcac62668d33"}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SO","PrimaryAttribute":"Survey Options","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":{"BackButton":"false","SaveAndContinue":"true","SurveyProtection":"PublicSurvey","BallotBoxStuffingPrevention":"false","NoIndex":"Yes","SecureResponseFiles":"true","SurveyExpiration":"None","SurveyTermination":"DefaultMessage","Header":"","Footer":"","ProgressBarDisplay":"None","PartialData":"+1 week","ValidationMessage":"","PreviousButton":"","NextButton":"","SurveyTitle":"Qualtrics Survey | Qualtrics Experience Management","SkinLibrary":"Qualtrics","SkinType":"templated","Skin":{"brandingId":null,"templateId":"*base","overrides":null},"NewScoring":1,"SurveyMetaDescription":"The most powerful, simple and trusted way to gather experience data. Start your journey to experience management and try a free account today.","ProtectSelectionIds":true,"SurveyName":"AAPOR 2024 Demo (v2 - js)"}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"QGO","PrimaryAttribute":"QGO_QuotaGroupOrder","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":["QG_pCAD92nqJBKyEk0"]},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SCO","PrimaryAttribute":"Scoring","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":{"ScoringCategories":[],"ScoringCategoryGroups":[],"ScoringSummaryCategory":null,"ScoringSummaryAfterQuestions":0,"ScoringSummaryAfterSurvey":0,"DefaultScoringCategory":null,"AutoScoringCategory":null}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"PROJ","PrimaryAttribute":"CORE","SecondaryAttribute":null,"TertiaryAttribute":"1.1.0","Payload":{"ProjectCategory":"CORE","SchemaVersion":"1.1.0"}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"STAT","PrimaryAttribute":"Survey Statistics","SecondaryAttribute":null,"TertiaryAttribute":null,"Payload":{"MobileCompatible":true,"ID":"Survey Statistics"}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SQ","PrimaryAttribute":"QID2","SecondaryAttribute":"${e:\/\/Field\/prompt1Completion}","TertiaryAttribute":null,"Payload":{"QuestionText":"${e:\/\/Field\/prompt1Completion}<br>","DefaultChoices":false,"DataExportTag":"q2","QuestionType":"TE","Selector":"SL","DataVisibility":{"Private":false,"Hidden":false},"Configuration":{"QuestionDescriptionOption":"UseText"},"QuestionDescription":"${e:\/\/Field\/prompt1Completion}","Validation":{"Settings":{"ForceResponse":"OFF","Type":"None"}},"GradingData":[],"Language":[],"NextChoiceId":4,"NextAnswerId":1,"SearchSource":{"AllowFreeResponse":"false"},"QuestionID":"QID2"}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SQ","PrimaryAttribute":"QID4","SecondaryAttribute":"${q:\/\/QID1\/ChoiceTextEntryValue}","TertiaryAttribute":null,"Payload":{"QuestionText":"${q:\/\/QID1\/ChoiceTextEntryValue}","DefaultChoices":false,"DataExportTag":"Q4","QuestionID":"QID4","QuestionType":"DB","Selector":"TB","DataVisibility":{"Private":false,"Hidden":false},"Configuration":{"QuestionDescriptionOption":"UseText"},"QuestionDescription":"${q:\/\/QID1\/ChoiceTextEntryValue}","ChoiceOrder":[],"Validation":{"Settings":{"Type":"None"}},"GradingData":[],"Language":[],"NextChoiceId":4,"NextAnswerId":1}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"QC","PrimaryAttribute":"Survey Question Count","SecondaryAttribute":"4","TertiaryAttribute":null,"Payload":null},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"QG","PrimaryAttribute":"QG_pCAD92nqJBKyEk0","SecondaryAttribute":"Default Quota Group","TertiaryAttribute":null,"Payload":{"ID":"QG_pCAD92nqJBKyEk0","Name":"Default Quota Group","Selected":true,"MultipleMatch":"PlaceInAll","Public":false,"Quotas":[]}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"RS","PrimaryAttribute":"RS_eyrJnYYyoa9hjdI","SecondaryAttribute":"Default Response Set","TertiaryAttribute":null,"Payload":null},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SQ","PrimaryAttribute":"QID1","SecondaryAttribute":"In one sentence or more, describe your opinion of Taylor Swift.","TertiaryAttribute":null,"Payload":{"QuestionText":"In one sentence or more, describe your opinion of <b>Taylor Swift.<\/b>","QuestionJS":"Qualtrics.SurveyEngine.addOnload(function()\n{\n\t\/*Place your JavaScript here to run when the page loads*\/\n\t\n});\n\nQualtrics.SurveyEngine.addOnReady(function()\n{\n\t\/*Place your JavaScript here to run when the page is fully displayed*\/\n\n});\n\nQualtrics.SurveyEngine.addOnUnload(function()\n{\n\t\/*Place your JavaScript here to run when the page is unloaded*\/\n\n});","DefaultChoices":false,"DataExportTag":"q1","QuestionID":"QID1","QuestionType":"TE","Selector":"SL","DataVisibility":{"Private":false,"Hidden":false},"Configuration":{"QuestionDescriptionOption":"UseText"},"QuestionDescription":"In one sentence or more, describe your opinion of Taylor Swift.","Validation":{"Settings":{"ForceResponse":"OFF","Type":"None"}},"GradingData":[],"Language":[],"NextChoiceId":4,"NextAnswerId":1,"SearchSource":{"AllowFreeResponse":"false"}}},{"SurveyID":"SV_4SnFxCjRrDUHhrg","Element":"SQ","PrimaryAttribute":"QID3","SecondaryAttribute":"Please wait. All set! Please proceed by clicking the arrow button. \u00a0","TertiaryAttribute":null,"Payload":{"QuestionText":"<style type=\"text\/css\">.spinner {\n  border: 4px solid rgba(0, 0, 0, 0.1);\n  width: 36px;\n  height: 36px;\n  border-radius: 50%;\n  border-left-color: #09f;\n  animation: spin 1s ease infinite;\n\n  \/* Centering styles *\/\n  position: absolute; \/* Use absolute positioning within a relative container *\/\n  top: 50%; \/* Position the top edge of the spinner in the middle of the container *\/\n  left: 50%; \/* Position the left edge of the spinner in the middle of the container *\/\n  transform: translate(-50%, -50%); \/* Offset the spinner by half its width and height to center it *\/\n}\n\n\/* Make sure the parent container has a relative position *\/\n#parentContainer {\n  position: relative;\n}\n\n@keyframes spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  100% {\n    transform: rotate(360deg);\n  }\n}\n<\/style>\n<div style=\"display: none;\" id=\"loadingMessage\">\n<p>Please wait.<\/p>\n<\/div>\n\n<div style=\"display: none;\" id=\"finishedMessage\">\n<p>All set! Please proceed by clicking the arrow button.<\/p>\n<\/div>\n\n<div style=\"display:none;\" id=\"loadingSpinner\" class=\"spinner\">&nbsp;<\/div>","DefaultChoices":false,"DataExportTag":"prompt1","QuestionType":"DB","Selector":"TB","DataVisibility":{"Private":false,"Hidden":false},"Configuration":{"QuestionDescriptionOption":"UseText"},"QuestionDescription":"Please wait. All set! Please proceed by clicking the arrow button. \u00a0","ChoiceOrder":[],"Validation":{"Settings":{"Type":"None"}},"GradingData":[],"Language":[],"NextChoiceId":4,"NextAnswerId":1,"QuestionID":"QID3","QuestionJS":"Qualtrics.SurveyEngine.addOnload(function() {\n    \/* Place your JavaScript here to run when the page loads *\/\n    this.hideNextButton();\n    document.getElementById('loadingMessage').style.display = 'block'; \/\/ Show loading message\n    document.getElementById('loadingSpinner').style.display = 'block'; \/\/ Show loading spinner\n\n    \/\/ Set variables containing user responses and model prompt\n    var sys_prompt = \" \\\n        You are a survey interviewer. \\\n        You will be provided a survey question and a response given by a respondent. \\\n        Your job is to probe further about the underlying motivations for their response.\\\n    \";\n\n    var user_prompt = \" \\\n        [Question]: ${q:\/\/QID1\/QuestionText} \\\n        [Respondent Answer]: ${q:\/\/QID1\/ChoiceTextEntryValue} \\\n    \";\n\n    \/\/ Define function to call LLM\n    function sendPromptToLLM(systemPrompt, userPrompt, onSuccess, onError) {\n        \/\/ Extract global settings for LLM (must be stored in embedded Qualtrics data)\n        var apiKey = Qualtrics.SurveyEngine.getEmbeddedData('apiKey');\n        var baseModel = Qualtrics.SurveyEngine.getEmbeddedData('baseModel');\n        var apiUrl = Qualtrics.SurveyEngine.getEmbeddedData('apiUrl');\n\n        var xhr = new XMLHttpRequest();\n        xhr.open(\"POST\", apiUrl);\n\n        \/\/ Prepare request\n        var data = JSON.stringify({\n            model: baseModel,\n            temperature: 0.5,\n            max_tokens: 100,\n            messages: [\n                { \"role\": \"system\", \"content\": systemPrompt },\n                { \"role\": \"user\", \"content\": userPrompt }\n            ]\n        });\n        xhr.setRequestHeader(\"Content-Type\", \"application\/json\");\n        xhr.setRequestHeader(\"Authorization\", apiKey);\n\n        \/\/ Set a reasonable timeout for the request (e.g., 90 seconds)\n        xhr.timeout = 90000; \/\/ 90,000 milliseconds = 90 seconds\n\n        \/\/ Define action after response is received\n        xhr.onreadystatechange = function() {\n            if (xhr.readyState === XMLHttpRequest.DONE) {\n                document.getElementById('loadingSpinner').style.display = 'none'; \/\/ Always hide loading spinner\n                document.getElementById('loadingMessage').style.display = 'none'; \/\/ Always hide loading message\n\n                if (xhr.status === 200) {\n                    try {\n                        var response = JSON.parse(xhr.responseText);\n                        var modelResponse = response.choices[0].message.content;\n                        Qualtrics.SurveyEngine.setEmbeddedData('prompt1Completion', modelResponse);\n                        onSuccess(modelResponse);\n                    } catch (e) {\n                        console.error(\"Error parsing response:\", e);\n                        onError(\"Failed to parse response\");\n                    }\n                } else {\n                    console.error(\"Error from OpenAI:\", xhr.responseText);\n                    onError(\"Error: \" + xhr.status);\n                    Qualtrics.SurveyEngine.setEmbeddedData('prompt1Completion', 'Error ' + xhr.status);\n                }\n                document.querySelector('.NextButton').style.display = ''; \/\/ Show the Next button\n                document.getElementById('finishedMessage').style.display = 'block'; \/\/ Show finished loading message\n            }\n        };\n\n        \/\/ Define action if request times out\n        xhr.ontimeout = function() {\n            console.error(\"Request timed out\");\n            onError(\"Request timed out\");\n            document.getElementById('loadingSpinner').style.display = 'none';\n            document.getElementById('loadingMessage').style.display = 'none';\n            document.getElementById('finishedMessage').style.display = 'block';\n            document.querySelector('.NextButton').style.display = '';\n        };\n\n        console.log(\"Model: \", baseModel);\n\n        \/\/ Fire off HTTP request\n        xhr.send(data);\n    }\n\n    \/\/ Call function\n    sendPromptToLLM(sys_prompt, user_prompt, function(response) {\n        console.log(\"API says:\", response);\n        \/\/ Save request information (save any real action for next question)\n        Qualtrics.SurveyEngine.setEmbeddedData('sys_prompt', sys_prompt);\n        Qualtrics.SurveyEngine.setEmbeddedData('user_prompt', user_prompt);\n    }, function(error) {\n        console.log(error);\n    });\n\n});"}}]}